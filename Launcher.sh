#!/bin/bash
# Stoppe le container nommé
echo "****************************************************************************************************"
echo "**************************************** Arrêt du container. ***************************************"
echo "****************************************************************************************************"
docker stop forum
echo "****************************************** Container arrêté.****************************************"
echo
# Supprime le container nommé
echo "****************************************************************************************************"
echo "************************************* Suppression du container. ************************************"
echo "****************************************************************************************************"
docker rm forum
echo "**************************************** Container supprimé. ***************************************"
echo
# Suppression de l'image au nom précisé.
echo "****************************************************************************************************"
echo "**** Suppression d'une éventuelle image portant déja le nom de l'image que l'on souhaite créer. ****"
echo "****************************************************************************************************"
docker container rm -f forum
echo "*********************************** Plus d'image au nom précisé. ***********************************"
echo
# Vidage du cache.
echo "****************************************************************************************************"
echo "***************************************** Vidage du cache. *****************************************"
echo "****************************************************************************************************"
docker image prune
echo "******************************************** Cache vidé. *******************************************"
echo
# Création de l'image au nom précisé dans le dockerfile.
echo "****************************************************************************************************"
echo "************************* Création de l'image nommée forum ***************************"
echo "****************************************************************************************************"
docker build --tag forum .
echo "******************************************* Image Créée. *******************************************"
echo
# Créé et lance le container -d detash (console accessible), -p publish (ports e:s) --name (definition du nom du container) + nom de l'image
echo "****************************************************************************************************"
echo "******************* Création et execution du container nommé forum *******************"
echo "************************ sur le port TCP 8080 et détachement de la console *************************"
echo "****************************************************************************************************"
docker run -d -p 8080:8080 --name forum forum
echo "*********************************** Container créé et executé. *************************************"
echo

echo "****************************************************************************************************"
echo "************************************* Adresse du site internet *************************************"
echo "************************************** http://localhost:8080 ***************************************"
echo "****************************************************************************************************"
echo

# Ouverture du serveur.
# echo "Ouverture du serveur dans le navigateur"
# open http://localhost:8080 &
# echo "Serveur atteint dans le navigateur."
# sleep 1
# exit
